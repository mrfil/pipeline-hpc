
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Heuristics &#8212; BIC 3T MRI Pipeline HPC 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Install" href="Install.html" />
    <link rel="prev" title="Sub-Pipelines" href="Sub-Pipelines.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="heuristics">
<span id="id1"></span><h1>Heuristics<a class="headerlink" href="#heuristics" title="Permalink to this headline">Â¶</a></h1>
<p>Converting data from DICOMs to BIDS-compatible NIFTIs &amp; JSONs can be facilitated using a number of toolboxes (<a class="reference external" href="https://bidscoin.readthedocs.io/en/stable/">BIDScoin</a>, <a class="reference external" href="https://github.com/wulms/bidsconvertr">BIDSconvertR</a>, <a class="reference external" href="https://github.com/nipy/heudiconv">HeuDiConv</a>, etc.).
Our pipelines currently use HeuDiConv, which uses a set of user-defined rules in a heuristic.py file to sort which DICOMs are converted to BIDS format and defines the names for the BIDS files associated with those DICOM series.</p>
<p>For a detailed walkthrough on using HeuDiConv (<em>written for an earlier version of the BIDS Specification</em>), check out <a class="reference external" href="https://reproducibility.stanford.edu/bids-tutorial-series-part-2a/">the Stanford CRN BIDS Tutorial Series: HeuDiConv Walkthrough</a>.</p>
<p>If you are planning a new study, you should consider using the sequence naming conventions specified by <a class="reference external" href="https://github.com/ReproNim/reproin">the Reproin project</a> from ReproNim.
These are based on the BIDS specification and can simplify comparison with other scans/studies.</p>
<p>In any case, you will likely need to adjust your heuristic.py file iteratively at the start of working with a new dataset.
This pipeline repo contains the example heuristic.py - <a class="reference external" href="https://github.com/mrfil/7T-pipeline-hpc/blob/main/main_heuristic.py">main_heuristic.py</a> - that should be modified to fit your study scan protocol.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">create_key</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">outtype</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;nii.gz&#39;</span><span class="p">,),</span> <span class="n">annotation_classes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="k">if</span> <span class="n">template</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">template</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Template must be a valid format string&#39;</span><span class="p">)</span>
<span class="k">return</span> <span class="n">template</span><span class="p">,</span> <span class="n">outtype</span><span class="p">,</span> <span class="n">annotation_classes</span>

<span class="k">def</span> <span class="nf">infotodict</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">):</span>
<span class="sd">&quot;&quot;&quot;Heuristic evaluator for determining which runs belong where</span>
<span class="sd">allowed template fields - follow python string module:</span>
<span class="sd">item: index within category</span>
<span class="sd">subject: participant id</span>
<span class="sd">seqitem: run number during scanning</span>
<span class="sd">subindex: sub index within group</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">t1w</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span><span class="s1">&#39;sub-</span><span class="si">{subject}</span><span class="s1">/</span><span class="si">{session}</span><span class="s1">/anat/sub-</span><span class="si">{subject}</span><span class="s1">_</span><span class="si">{session}</span><span class="s1">_T1w&#39;</span><span class="p">)</span>
<span class="n">FLAIR</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span><span class="s1">&#39;sub-</span><span class="si">{subject}</span><span class="s1">/</span><span class="si">{session}</span><span class="s1">/anat/sub-</span><span class="si">{subject}</span><span class="s1">_</span><span class="si">{session}</span><span class="s1">_FLAIR&#39;</span><span class="p">)</span>
<span class="n">dwi</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span><span class="s1">&#39;sub-</span><span class="si">{subject}</span><span class="s1">/</span><span class="si">{session}</span><span class="s1">/dwi/sub-</span><span class="si">{subject}</span><span class="s1">_</span><span class="si">{session}</span><span class="s1">_run-</span><span class="si">{item:01d}</span><span class="s1">_dwi&#39;</span><span class="p">)</span>
<span class="n">rest</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span><span class="s1">&#39;sub-</span><span class="si">{subject}</span><span class="s1">/</span><span class="si">{session}</span><span class="s1">/func/sub-</span><span class="si">{subject}</span><span class="s1">_</span><span class="si">{session}</span><span class="s1">_task-rest_dir-PA_run-</span><span class="si">{item:01d}</span><span class="s1">_bold&#39;</span><span class="p">)</span>
<span class="n">fmap_fmri</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span><span class="s1">&#39;sub-</span><span class="si">{subject}</span><span class="s1">/</span><span class="si">{session}</span><span class="s1">/fmap/sub-</span><span class="si">{subject}</span><span class="s1">_</span><span class="si">{session}</span><span class="s1">_acq-</span><span class="si">{acq}</span><span class="s1">_dir-</span><span class="si">{dir}</span><span class="s1">_run-</span><span class="si">{item:01d}</span><span class="s1">_epi&#39;</span><span class="p">)</span>
<span class="n">fmap_dwi</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span><span class="s1">&#39;sub-</span><span class="si">{subject}</span><span class="s1">/</span><span class="si">{session}</span><span class="s1">/fmap/sub-</span><span class="si">{subject}</span><span class="s1">_</span><span class="si">{session}</span><span class="s1">_acq-</span><span class="si">{acq}</span><span class="s1">_dir-</span><span class="si">{dir}</span><span class="s1">_run-</span><span class="si">{item:01d}</span><span class="s1">_epi&#39;</span><span class="p">)</span>
<span class="n">fmap_tfmri</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span><span class="s1">&#39;sub-</span><span class="si">{subject}</span><span class="s1">/</span><span class="si">{session}</span><span class="s1">/fmap/sub-</span><span class="si">{subject}</span><span class="s1">_</span><span class="si">{session}</span><span class="s1">_acq-</span><span class="si">{acq}</span><span class="s1">_dir-</span><span class="si">{dir}</span><span class="s1">_run-</span><span class="si">{item:01d}</span><span class="s1">_epi&#39;</span><span class="p">)</span>
<span class="n">rest_sbref</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span><span class="s1">&#39;sub-</span><span class="si">{subject}</span><span class="s1">/</span><span class="si">{session}</span><span class="s1">/func/sub-</span><span class="si">{subject}</span><span class="s1">_</span><span class="si">{session}</span><span class="s1">_task-rest_dir-PA_run-1_sbref&#39;</span><span class="p">)</span>
<span class="n">tfunc</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span><span class="s1">&#39;sub-</span><span class="si">{subject}</span><span class="s1">/</span><span class="si">{session}</span><span class="s1">/func/sub-</span><span class="si">{subject}</span><span class="s1">_</span><span class="si">{session}</span><span class="s1">_task-</span><span class="si">{task}</span><span class="s1">_dir-PA__run-</span><span class="si">{item:01d}</span><span class="s1">_bold&#39;</span><span class="p">)</span>
<span class="n">swi</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span><span class="s1">&#39;sub-</span><span class="si">{subject}</span><span class="s1">/</span><span class="si">{session}</span><span class="s1">/derivatives/swi/sub-</span><span class="si">{subject}</span><span class="s1">_</span><span class="si">{session}</span><span class="s1">_acq-</span><span class="si">{acq}</span><span class="s1">_dir-PA_run-</span><span class="si">{item:01d}</span><span class="s1">_t2star&#39;</span><span class="p">)</span>
<span class="n">asl</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span><span class="s1">&#39;sub-</span><span class="si">{subject}</span><span class="s1">/</span><span class="si">{session}</span><span class="s1">/derivatives/perf/sub-</span><span class="si">{subject}</span><span class="s1">_</span><span class="si">{session}</span><span class="s1">_acq-</span><span class="si">{acq}</span><span class="s1">_run-</span><span class="si">{item:01d}</span><span class="s1">_asl&#39;</span><span class="p">)</span>
<span class="n">t2w</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span><span class="s1">&#39;sub-</span><span class="si">{subject}</span><span class="s1">/</span><span class="si">{session}</span><span class="s1">/anat/sub-</span><span class="si">{subject}</span><span class="s1">_</span><span class="si">{session}</span><span class="s1">_acq-</span><span class="si">{acq}</span><span class="s1">_run-</span><span class="si">{item:01d}</span><span class="s1">_T2w&#39;</span><span class="p">)</span>

<span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="n">t1w</span><span class="p">:</span> <span class="p">[],</span> <span class="n">dwi</span><span class="p">:</span> <span class="p">[],</span> <span class="n">t2w</span><span class="p">:</span> <span class="p">[],</span> <span class="n">FLAIR</span><span class="p">:</span> <span class="p">[],</span> <span class="n">rest</span><span class="p">:</span> <span class="p">[],</span> <span class="n">rest_sbref</span><span class="p">:</span> <span class="p">[],</span> <span class="n">fmap_fmri</span><span class="p">:</span> <span class="p">[],</span> <span class="n">fmap_tfmri</span><span class="p">:</span> <span class="p">[]</span> <span class="p">,</span> <span class="n">fmap_dwi</span><span class="p">:</span> <span class="p">[],</span> <span class="n">tfunc</span><span class="p">:</span> <span class="p">[],</span> <span class="n">swi</span><span class="p">:</span> <span class="p">[],</span> <span class="n">asl</span><span class="p">:</span> <span class="p">[]}</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">seqinfo</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;T1w&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">s</span><span class="o">.</span><span class="n">dim3</span> <span class="o">==</span> <span class="mi">192</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">dim4</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)))</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;t1&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">):</span>
        <span class="n">info</span><span class="p">[</span><span class="n">t1w</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">]</span> <span class="c1"># assign if a single series meets criteria</span>
    <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;dwi&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">s</span><span class="o">.</span><span class="n">dim1</span> <span class="o">==</span> <span class="mi">92</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">TR</span> <span class="o">==</span> <span class="mf">2.8</span><span class="p">)))</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;cmrr&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">):</span>
        <span class="n">info</span><span class="p">[</span><span class="n">dwi</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">})</span> <span class="c1"># append if multiple series meet criteria</span>
    <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;dwi&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;fmap&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">))</span> <span class="ow">or</span> <span class="p">((</span><span class="s1">&#39;DTIField&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">TR</span> <span class="o">==</span> <span class="mf">8.29</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;AP&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">):</span>
            <span class="n">info</span><span class="p">[</span><span class="n">fmap_dwi</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">,</span> <span class="s1">&#39;acq&#39;</span><span class="p">:</span> <span class="s1">&#39;dwi&#39;</span><span class="p">,</span> <span class="s1">&#39;dir&#39;</span><span class="p">:</span> <span class="s1">&#39;AP&#39;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info</span><span class="p">[</span><span class="n">fmap_dwi</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">,</span> <span class="s1">&#39;acq&#39;</span><span class="p">:</span> <span class="s1">&#39;dwi&#39;</span><span class="p">,</span> <span class="s1">&#39;dir&#39;</span><span class="p">:</span> <span class="s1">&#39;PA&#39;</span><span class="p">})</span>
    <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;T2w&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">TR</span> <span class="o">==</span> <span class="mi">6</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;flair&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">):</span>
        <span class="n">info</span><span class="p">[</span><span class="n">FLAIR</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;T2w&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;highreshippocampus&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">):</span>
        <span class="n">info</span><span class="p">[</span><span class="n">t2w</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">,</span> <span class="s1">&#39;acq&#39;</span><span class="p">:</span> <span class="s1">&#39;highreshippocampus&#39;</span><span class="p">})</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">dim4</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;rest&#39;</span> <span class="ow">or</span> <span class="s1">&#39;REST_PA&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;cmrr&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">):</span>
        <span class="n">info</span><span class="p">[</span><span class="n">rest</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">dim4</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;rest&#39;</span> <span class="ow">or</span> <span class="s1">&#39;REST_PA&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;fmap&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;cmrr&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">):</span>
        <span class="n">info</span><span class="p">[</span><span class="n">rest_sbref</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">dim4</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;task&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;rest&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">):</span>
        <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;_task-&#39;</span>
        <span class="n">suff</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span>
        <span class="n">taskname</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">pref</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">(</span><span class="n">suff</span><span class="p">)]</span>
        <span class="n">info</span><span class="p">[</span><span class="n">tfunc</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">,</span> <span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="n">taskname</span><span class="p">})</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">dim4</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;nback&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">):</span>
        <span class="n">info</span><span class="p">[</span><span class="n">tfunc</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">,</span> <span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="s1">&#39;nback&#39;</span><span class="p">})</span>
    <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;fmap&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;rest&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;fMRIFieldMap&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;AP&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">):</span>
            <span class="n">info</span><span class="p">[</span><span class="n">fmap_fmri</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">,</span> <span class="s1">&#39;acq&#39;</span><span class="p">:</span> <span class="s1">&#39;fMRIrest&#39;</span><span class="p">,</span> <span class="s1">&#39;dir&#39;</span><span class="p">:</span> <span class="s1">&#39;AP&#39;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info</span><span class="p">[</span><span class="n">fmap_fmri</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">,</span> <span class="s1">&#39;acq&#39;</span><span class="p">:</span> <span class="s1">&#39;fMRIrest&#39;</span><span class="p">,</span> <span class="s1">&#39;dir&#39;</span><span class="p">:</span> <span class="s1">&#39;PA&#39;</span><span class="p">})</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;fmap&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;nback&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;AP&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">):</span>
            <span class="n">info</span><span class="p">[</span><span class="n">fmap_tfmri</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">,</span> <span class="s1">&#39;acq&#39;</span><span class="p">:</span> <span class="s1">&#39;fMRI&#39;</span><span class="p">,</span> <span class="s1">&#39;dir&#39;</span><span class="p">:</span> <span class="s1">&#39;AP&#39;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info</span><span class="p">[</span><span class="n">fmap_tfmri</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">,</span> <span class="s1">&#39;acq&#39;</span><span class="p">:</span> <span class="s1">&#39;fMRI&#39;</span><span class="p">,</span> <span class="s1">&#39;dir&#39;</span><span class="p">:</span> <span class="s1">&#39;PA&#39;</span><span class="p">})</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;fmap&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;task&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;rest&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;nback&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">):</span>
        <span class="n">pref</span> <span class="o">=</span> <span class="s1">&#39;_task-&#39;</span>
        <span class="n">suff</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span>
        <span class="n">taskname</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">pref</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">(</span><span class="n">suff</span><span class="p">)]</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;_AP&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">):</span>
            <span class="n">info</span><span class="p">[</span><span class="n">fmap_tfmri</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">,</span> <span class="s1">&#39;acq&#39;</span><span class="p">:</span> <span class="s1">&#39;fMRI&#39;</span><span class="p">,</span> <span class="s1">&#39;dir&#39;</span><span class="p">:</span> <span class="s1">&#39;AP&#39;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info</span><span class="p">[</span><span class="n">fmap_tfmri</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">,</span> <span class="s1">&#39;acq&#39;</span><span class="p">:</span> <span class="s1">&#39;fMRI&#39;</span><span class="p">,</span> <span class="s1">&#39;dir&#39;</span><span class="p">:</span> <span class="s1">&#39;PA&#39;</span><span class="p">})</span>
<span class="k">return</span> <span class="n">info</span>
</pre></div>
</div>
<p>Running HeuDiConv with your adjusted heuristic.py will depend on your use case and installation method.</p>
<p>After conversion to BIDS using HeuDiConv, you will need to make sure that any fieldmap images used for susceptibility distortion correction (for fMRI and DWI)
have IntendedFor items in their BIDS sidecar JSON files. Our pipeline automates this using jq and bash, but it always good to check these JSONs in the bids/sourcedata/sub-&lt;participantID&gt;/ses-&lt;sessionID&gt;/fmap directory.</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">BIC 3T MRI Pipeline HPC</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="About.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="Usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="Main-Pipeline.html">Main Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="Sub-Pipelines.html">Sub-Pipelines</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Heuristics</a></li>
<li class="toctree-l1"><a class="reference internal" href="Install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQs.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="Troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="Citing.html">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Requests.html">Requests</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="Sub-Pipelines.html" title="previous chapter">Sub-Pipelines</a></li>
      <li>Next: <a href="Install.html" title="next chapter">Install</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Paul B Camacho, Evan D Anderson, Nishant Bhamidipati, Aaron T Anderson, Benjamin Zimmerman, Matthew S Moore, Ezra Paul Winter-Nelson, Maximillian K Egan, Brad P Sutton.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/Heuristics.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>